

获取可转债日期2021.11.1

可转债赎回的比例测算 - 数据来源
从wind提取可转债共724支（包括1.债券分类（WIND）- 可转债， 2. 已到期债券-已到期可转债， 3. 已摘牌未到期债券 - 已摘牌未到期可转债），原始文件见allConvertibleBonds-allSample。 除去了没法做赎回测试的可转债共70支（例如没有赎回条款的，或没有条件赎回条款的，即条件赎回起始日期和条件赎回截止日期获取不到的）
正股代码取不出的去掉
赎回触发计算最大时间区间为0的,赎回触发计算时间区间=0，赎回触发比例=0的去掉
去掉了赎回开始日期在11月2日之后的（即还没到赎回开始日的）
去掉100087 水运转债 - 原因是取不到转股期开始后收盘价，无法进行测算。
还剩585只转债 -> 为总的测算样本量


cbConvertPriceAndStockClosingPriceInfo-combined.npy是所有586只转债的信息
key为每个可转债的code
格式为：
'128145.SZ'：{
'日期'：[]
'收盘价':[]
'转股价':[]
	}
日期中每个值为datetime.datetime, 是从条件赎回起始日期 到 11月2日与赎回截止日较小者


最终处理好的数据源是cbConvertPriceAndStockClosingPriceInfo-final.npy是所有586只转债的信息
key为每个可转债的code
格式为：
'128145.SZ'：{
'日期'：[]
 :[]
'转股价':[]
'赎回触发计算时间区间':
'赎回触发计算最大时间区间':
'赎回触发比例':
	}
日期中每个值为datetime.datetime, 是从条件赎回起始日期 到 11月2日与赎回截止日较小者

查看所有可转债的赎回条款时发现，条件赎回条款大致分为2种情况
1） 任何连续X个交易日中有至少Y个交易日的收盘价不低于该30个交易日内生效转股价格的Z％
2） 在转股期内,公司股票在任意连续X个交易日中的收盘价不低于转股价格的Z%时
模型中是按照1）来算的。
赎回测试中将分情况测算，可通过check 赎回触发计算最大时间区间 是否等于赎回触发计算时间区间，来判断是否为情况2，若相等，为情况2



结果：584只可转债中有342个触发了赎回条款，其中238个发了赎回公告，大约占比238/342 = 69.59%, 东吴研报中用的是75%


q为0到1的随机数
当 q<=0.2时，触发回售条件后发生回售，20%
当 0.2<q<0.7时，触发回售条件且满足下修条件，则发生下修。50%
q>=0.7时，即便触发回售条款也不会发生回售或下修。30%

看实际上触发回售条件后，发生回售的有多少个？
             触发回售条件后，发生下修的有多少个？
             触发回售条件后




回售测试：
去掉了不符合条件进行测试的（主要是回售条件约定的日期大部分都是可转债存续的最后两年，所以很多不符合）
只剩下126个符合条件的可转债，再去掉里面获取不到收盘价的（如收盘价为NoneType），剩下125只
测试结果：
125只里面有50只达到了回售条件。（已确认，见sellBackTestResult.xlsx, 由sellBackTestResult-2.csv整理得来）
13只取到了回售公告日，50个里面只有11个在wind查找回售公告时，回售公告说回售原因是因为连续多少个交易日股价低于XXX，其他的是没有找到回售公告或者是因达到其他条件要回售的（与股价无关的那种条件）

--现在问题是 如果50是正确的，则达到回售条件发生回售的概率为11/50 = 0.22 可以用0.2到0.3来表示，因为还有一些因为其他原因回售的
研报中用的0.2是证实比较合适的。
然后需要在剩下的里面一个一个看有多少个发生过下修的。- 代码已完成，但不确定是要看在哪个区间发生过下修。结果.xlsx中，确认发生回售的一列，为N的，共39个，这39个里面有多少个没有下修转股价？这39个放到xiaXiuToBeConfirm.csv里去跑。

######结论2022.1.7######
触发回售条款的一共50个，50个里面有11个发生了回售（22%），剩下的39个未发生回售的中，有7个下修了转股价（14%，因股价持续走低而发生下修-通过自行判断，以及从wind找下修公告等来判断的），32个是触发了回售条款但没回售也没下修的。（64%）
--> 14%和64%这两个比例与目前东吴里q的取值不符。
如果按照我的算法，应当为：
当 q<=0.22 时，触发回售条件后发生回售；当 0.22<q<0.36 时，触发回售条件且满足下修条
件，则发生下修；当 q>=0.36时，即便触发回售条款，也不会发生回售或者下修，债券将
继续存续。也就是说，大部分公司都不下修转股价。

需确认：

1. 转债的下修价格大概是多少
转债的下修价格平均比条款最低价格（20 天均价和 1 天前均价的最小值）
平均高出 5%，我们在模型中加入这个上浮比例。

2. 中债企业债收益率需要使用定价日前一日的，不是定价日当天的，（与东吴证券一致）


-需要确认，达到了回售条件后，没有回售也没有下修的，有多少个，问题是，如何定义达到回售条件后发生下修，是达到回售条件后的第一天就下修转股价算，还是隔了好多天下修转股价也算?
问题2：对于那些达到回售条件后，第二天没有下修的，是否要check这些股票后面的期间在哪天又达到了回售条件？？因为现在只check一次，即check到了就返回，不知道后面达到过多少次。

东吴证券：
为了妥善处理下修和回售的不确定性，我们按照以下假设进行：○1 认为只要触发回
售条件，公司才有意愿使用下修条款。○2 根据可转债市场的历史情况，

有 31 只可转债公布回售公告，其中 15 只可转债的投资者参与了回售，而 16 只可转债没有投资者参与
回售；
有 35 只可转债公布向下修正公告，其中 3 只可转债因为根据下修条款计算的转股价格大于当前转股价，未发生下修。

因此，我们设定下修概率 q（0 到 1 的随机数），
当 q<=0.2 时，触发回售条件后发生回售；当 0.2<q<0.7 时，触发回售条件且满足下修条
件，则发生下修；当 q>=0.7 时，即便触发回售条款，也不会发生回售或者下修，债券将
继续存续。○3 根据市场的统计，由于一些转载条款的额外要求和市场情况（例如要求超
过股价面值），转债的下修价格平均比条款最低价格（20 天均价和 1 天前均价的最小值）
平均高出 5%，我们在模型中加入这个上浮比例。


回售：根据假设 7，触发条件的公司中，50%会选择下修转股价。20%的公司会选择
回售。30%的公司或者由于目标下修价格没有超过之前转股价，而未完成下修，或者投
资者没有采用回售条款，而继续保持存续的状态。

















战略：杭建平
经济：郭守杰
审计：金鑫松
会计：张敬富